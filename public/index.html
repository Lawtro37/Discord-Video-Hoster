<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Video Hoster</title>
    <style>
      body { font-family: system-ui, Arial; max-width:800px; margin:40px auto; padding:0 20px; }
      .drop { border:2px dashed #888; padding:40px; text-align:center; border-radius:8px; }
      .links { margin-top:20px; }
      input[type=file]{ display:block; margin:10px auto; }
    </style>
  </head>
  <body>
    <h1>Video Hoster</h1>
    <div class="drop" id="drop">Drop a video here or select one</div>
    <input id="file" type="file" accept="video/*" />
    <div class="links" id="links"></div>

    <script>
      const drop = document.getElementById('drop');
      const fileInput = document.getElementById('file');
      const links = document.getElementById('links');

      ['dragenter','dragover','dragleave','drop'].forEach(e=>{
        drop.addEventListener(e, ev=>ev.preventDefault());
      });
      drop.addEventListener('drop', ev=>{
        const f = ev.dataTransfer.files[0];
        if (f) upload(f);
      });
      fileInput.addEventListener('change', ev=>{
        const f = ev.target.files[0];
        if (f) upload(f);
      });

      async function upload(file){
        links.innerHTML = 'Uploading...';
        const fd = new FormData();
        fd.append('file', file);
        try{
          const res = await fetch('/upload', { method:'POST', body: fd });
          const j = await res.json();
          if (j.error) { links.textContent = 'Error: ' + j.error; return; }
          links.innerHTML = `<p>Video URL: <a href="${j.videoUrl}" target="_blank">${j.videoUrl}</a></p>
          <p>Short URL: <a href="${j.shortUrl}" target="_blank">${j.shortUrl}</a></p>
          <video src="/v/${j.id}" controls width="480"></video>`;
        }catch(err){
          links.textContent = 'Upload failed: ' + err;
        }
      }
    </script>
  </body>
</html>
